"use strict";(self.webpackChunkdance_event_app=self.webpackChunkdance_event_app||[]).push([[252],{252:(e,a,t)=>{t.r(a),t.d(a,{default:()=>i});var l=t(43),s=t(203),n=t(951),r=t(579);const i=e=>{var a;let{paymentData:t,selectedSlots:i,performanceType:d,participantDetails:o,onStatusConfirmed:c,onStatusFailed:m}=e;const[u,x]=(0,l.useState)(!0),[p,f]=(0,l.useState)(30),[h,y]=(0,l.useState)("checking");(0,l.useEffect)(()=>{if(null===t||void 0===t||!t.paymentId)return void m("Invalid payment data");const e=setInterval(()=>{f(a=>a<=1?(clearInterval(e),x(!1),(0,s.jb)(t.paymentId).finally(()=>{m("Webhook timeout - payment status unclear")}),0):a-1)},1e3),a=(0,s.QJ)(t.paymentId,(a,t)=>{if(console.log("Booking status update:",a,t),"confirmed"===a)clearInterval(e),y("confirmed"),x(!1),c();else if("cancelled"===a){var l,s;clearInterval(e),y("failed"),x(!1);const a=(null===t||void 0===t||null===(l=t.originalBookingData)||void 0===l||null===(s=l.paymentData)||void 0===s?void 0:s.errorReason)||"Payment was declined or failed";m(a)}}),l=setInterval(async()=>{try{const i=await(0,s.Lh)(t.paymentId);if(console.log("Payment status check result:",i),"confirmed"===i.status)clearInterval(e),clearInterval(l),y("confirmed"),x(!1),c();else if("cancelled"===i.status){var a,n,r;clearInterval(e),clearInterval(l),y("failed"),x(!1);const t=(null===(a=i.booking)||void 0===a||null===(n=a.originalBookingData)||void 0===n||null===(r=n.paymentData)||void 0===r?void 0:r.errorReason)||"Payment was declined or failed";m(t)}else"not_found"===i.status&&(clearInterval(e),clearInterval(l),y("failed"),x(!1),await(0,s.jb)(t.paymentId),m("Payment could not be verified. Please retry."))}catch(i){console.error("Error checking payment status:",i)}},3e3);return()=>{clearInterval(e),clearInterval(l),a()}},[null===t||void 0===t?void 0:t.paymentId,c,m]);const v=n.J.performanceTypes.find(e=>e.id===d);return u?(0,r.jsxs)("div",{className:"text-center space-y-6",children:[(0,r.jsx)("div",{className:"w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center mx-auto",children:(0,r.jsx)("div",{className:"w-10 h-10 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Processing Payment..."}),(0,r.jsx)("p",{className:"text-gray-600 mb-4",children:"Please wait while we confirm your payment with our payment provider."}),(0,r.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4 inline-block",children:(0,r.jsxs)("p",{className:"text-sm text-blue-700",children:[(0,r.jsx)("span",{className:"font-medium",children:"Payment ID:"})," ",t.paymentId]})})]}),(0,r.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 max-w-md mx-auto",children:[(0,r.jsx)("p",{className:"text-sm text-yellow-700",children:(0,r.jsxs)("span",{className:"font-medium",children:["Timeout in ",p," seconds"]})}),(0,r.jsx)("p",{className:"text-xs text-yellow-600 mt-1",children:"We're waiting for payment confirmation from Razorpay"})]}),(0,r.jsxs)("div",{className:"bg-gray-50 rounded-lg p-6 text-left max-w-md mx-auto",children:[(0,r.jsx)("h4",{className:"font-semibold text-gray-800 mb-4 text-center",children:"Payment Details"}),(0,r.jsxs)("div",{className:"space-y-3 text-sm",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"Performance:"}),(0,r.jsx)("span",{className:"font-medium",children:null===v||void 0===v?void 0:v.name})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"Time Slots:"}),(0,r.jsx)("span",{className:"font-medium",children:i.length})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"Amount Paid:"}),(0,r.jsxs)("span",{className:"font-bold text-green-600",children:["\u20b9",null===(a=t.amount)||void 0===a?void 0:a.toLocaleString()]})]})]})]}),(0,r.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 max-w-md mx-auto",children:[(0,r.jsx)("h4",{className:"font-medium text-blue-800 mb-2",children:"What's happening?"}),(0,r.jsxs)("ul",{className:"text-sm text-blue-700 space-y-1 text-left",children:[(0,r.jsx)("li",{children:"\u2022 Your payment has been submitted to Razorpay"}),(0,r.jsx)("li",{children:"\u2022 We're waiting for payment confirmation"}),(0,r.jsx)("li",{children:"\u2022 This usually takes 5-10 seconds"}),(0,r.jsx)("li",{children:"\u2022 Please don't close this page"})]})]})]}):null}}}]);
//# sourceMappingURL=252.8f1e7ed8.chunk.js.map