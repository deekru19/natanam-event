"use strict";(self.webpackChunkdance_event_app=self.webpackChunkdance_event_app||[]).push([[161],{161:(e,r,t)=>{t.r(r),t.d(r,{default:()=>o});var s=t(43),a=t(951),n=t(579);const o=e=>{let{selectedSlots:r,performanceType:t,participantDetails:o,onPaymentSuccess:i,onPaymentFailure:c,onBack:l}=e;const[d,m]=(0,s.useState)(!1),[p,u]=(0,s.useState)(""),h=a.J.performanceTypes.find(e=>e.id===t);if(!h)return(0,n.jsx)("div",{children:"Invalid performance type."});const x=(()=>{switch(t){case"solo":default:return 1;case"duet":return 2;case"group":const e=o.participantNames||"";if(e.trim()){const r=e.split(/[,\n]/).filter(e=>e.trim()).length;return Math.max(r,1)}return 3}})(),y=r.length*h.pricePerPerson*x,g=()=>{switch(t){case"solo":return o.fullName||"N/A";case"duet":return o.participant1Name||"N/A";case"group":const e=o.participantNames||"";if(e.trim()){return e.split(/[,\n]/).filter(e=>e.trim())[0]||"N/A"}return"N/A";default:return"N/A"}};return(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"Complete Payment"}),(0,n.jsx)("button",{onClick:l,className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:"\u2190 Back"})]}),(0,n.jsxs)("div",{className:"bg-gray-50 rounded-lg p-6 space-y-4",children:[(0,n.jsx)("h4",{className:"font-medium text-gray-700 mb-3",children:"Payment Summary"}),(0,n.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{className:"text-gray-600",children:"Performance Type:"}),(0,n.jsx)("span",{className:"font-medium",children:h.name})]}),(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{className:"text-gray-600",children:"Participant(s):"}),(0,n.jsx)("span",{className:"font-medium",children:x})]}),(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{className:"text-gray-600",children:"Time Slots:"}),(0,n.jsx)("span",{className:"font-medium",children:r.length})]}),(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{className:"text-gray-600",children:"Price per person per slot:"}),(0,n.jsxs)("span",{className:"font-medium",children:["\u20b9",h.pricePerPerson]})]}),(0,n.jsxs)("div",{className:"border-t pt-2 mt-3",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsx)("span",{className:"font-medium text-gray-800",children:"Total Amount:"}),(0,n.jsxs)("span",{className:"text-xl font-bold text-gray-900",children:["\u20b9",y.toLocaleString()]})]}),(0,n.jsxs)("p",{className:"text-xs text-gray-500 mt-1 text-right",children:["\u20b9",h.pricePerPerson," \xd7 ",x," \xd7 ",r.length]})]})]})]}),(0,n.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,n.jsx)("h4",{className:"font-medium text-blue-800 mb-2",children:"Selected Time Slots"}),(0,n.jsx)("div",{className:"space-y-1",children:r.map((e,r)=>(0,n.jsxs)("p",{className:"text-sm text-blue-700",children:["\u2022 ",e]},r))})]}),(0,n.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[(0,n.jsx)("h4",{className:"font-medium text-green-800 mb-2",children:"Secure Payment"}),(0,n.jsxs)("ul",{className:"text-sm text-green-700 space-y-1",children:[(0,n.jsx)("li",{children:"\u2022 Payment is processed securely through Razorpay"}),(0,n.jsx)("li",{children:"\u2022 You can pay using UPI, Cards, Net Banking, or Wallets"}),(0,n.jsx)("li",{children:"\u2022 Your booking will be confirmed instantly upon successful payment"}),(0,n.jsx)("li",{children:"\u2022 You will receive a confirmation email after payment"})]})]}),p&&(0,n.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:(0,n.jsx)("p",{className:"text-sm text-red-600",children:p})}),(0,n.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,n.jsx)("button",{onClick:l,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors",disabled:d,children:"Back"}),(0,n.jsx)("button",{onClick:async()=>{m(!0),u("");try{if(!await new Promise(e=>{const r=document.createElement("script");r.src="https://checkout.razorpay.com/v1/checkout.js",r.onload=()=>e(!0),r.onerror=()=>e(!1),document.body.appendChild(r)}))throw new Error("Failed to load Razorpay. Please check your internet connection.");const{phone:s,email:a}={phone:o.phoneNumber||o.participant1Phone||o.representativePhone||"",email:o.email||""};let n;console.log("\ud83d\ude80 Creating Razorpay order for amount:",100*y,"paise");const l=async e=>{try{console.log("\ud83c\udf10 Calling Firebase Function at:",e);const a=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:100*y,currency:"INR",notes:{performance_type:t,time_slots:r.join(", "),participant_count:x.toString()}})});if(console.log("\ud83d\udce1 Order creation response status:",a.status),console.log("\ud83d\udce1 Order creation response headers:",Object.fromEntries(a.headers.entries())),a.ok){var s;const e=await a.json();return console.log("\u2705 Order created successfully:",e),null===e||void 0===e||null===(s=e.order)||void 0===s?void 0:s.id}{const e=await a.text();throw console.error("\u274c Order creation failed with status:",a.status),console.error("\u274c Order creation error response:",e),new Error(`Order creation failed: ${a.status} - ${e}`)}}catch(p){throw console.error("\u274c Order creation failed:",p),p}};try{const e="test-fe3f0";if(!e)throw new Error("Firebase Project ID not configured. Please check environment variables.");const r=`https://us-central1-${e}.cloudfunctions.net/createRazorpayOrder`;console.log("\ud83c\udf10 Creating order via Firebase Function:",r),n=await l(r),console.log("\u2705 Order created successfully via Firebase Function")}catch(e){return console.error("\ud83d\udca5 CRITICAL: Order creation failed:",e.message),u(`Failed to create payment order: ${e.message}. Please try again or contact support.`),void m(!1)}if(!n){const e="Order ID is missing after successful order creation";return console.error("\ud83d\udca5 CRITICAL:",e),u(e),void m(!1)}console.log("\ud83c\udfac Opening Razorpay payment modal with order ID:",n);const d={key:"rzp_test_kqMZu5Fx9pDa9x",amount:100*y,currency:"INR",name:"Natanam Dance Event",description:`${h.name} Performance Registration`,image:"/logo192.png",order_id:n,handler:function(e){console.log("\ud83c\udf89 Payment Success:",e),i({paymentId:e.razorpay_payment_id,orderId:e.razorpay_order_id,signature:e.razorpay_signature,amount:y,currency:"INR"})},prefill:{name:g(),email:a,contact:s},notes:{performance_type:t,time_slots:r.join(", "),participant_count:x.toString()},theme:{color:"#2563eb"},modal:{ondismiss:function(){m(!1)}}},f=new window.Razorpay(d);f.on("payment.failed",function(e){console.log("\u274c Payment Failed:",e),c({error:e.error,reason:e.error.reason,description:e.error.description})}),f.open(),m(!1)}catch(s){console.error("\ud83d\udca5 Payment initialization failed:",s),console.error("\ud83d\udca5 Error details:",{message:s.message,stack:s.stack,name:s.name}),u(s.message||"Failed to initialize payment. Please try again."),m(!1)}},disabled:d,className:"px-8 py-3 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium",children:d?"Processing...":`Pay \u20b9${y.toLocaleString()}`})]})]})}}}]);
//# sourceMappingURL=161.7c09f7a2.chunk.js.map